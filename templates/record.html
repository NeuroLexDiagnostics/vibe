<!DOCTYPE HTML>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        #demo {
          text-align: center;
          font-size: 60px;
          margin-top: 0;
        }
    </style>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/record.css') }}">
{#    <script src="https://webgazer.cs.brown.edu/webgazer.js?" type="text/javascript" ></script>#}
    <script src="{{ url_for('static', filename='scripts/webgazer.js') }}" type="text/javascript"></script>
</head>

<body>
<div class="container">
    <div class="row" style="align-content: center">
        <div class="col-lg-8  offset-lg-2">
            <h3 class="mt-5">Live Streaming</h3>
{#            <img src="{{url}} +'/video_feed" width="100%">#}
            <button id="start_button" onclick="startSession(5)">Begin Session</button>
        </div>
    </div>
    <p id="demo"></p>
</div>
</body>

<script>
    var predictionData = [];

    // Don't listen to mouse events
    // (this didn't seem to work though... the red dot still appears...)
    webgazer.removeMouseEventListeners();

    webgazer.setGazeListener(function(data, elapsedTime) {
        if (data == null) {
            return;
        }
        var x_prediction = data.x; //these x coordinates are relative to the viewport
        var y_prediction = data.y; //these y coordinates are relative to the viewport

        predictionData.push([x_prediction, y_prediction])
    }).begin();

    console.log("webgazer is ready");

    // Immediately stop collecting data and clear the cache until
    // a session is started
    webgazer.pause();
    console.log("webgazer is paused");

    predictionData = [];
    console.log(predictionData);

    function startSession(recordingTime) {
        // Start data collection
        webgazer.resume();
        console.log("starting webgazer");

        var downloadTimer = setInterval(function(){
            if(recordingTime <= 0){
                // Stop data collection and handle data
                webgazer.pause();

                // Send predictionData to backend somehow
                // possibly via jquery POST or something
                // TODO
                // ...
                // For whatever reason, this isn't working - no data is being collected here unless
                // the webgazer object is initialized and starts recording right away. Huh.
                console.log(predictionData);

                // Finally, stop the timer
                clearInterval(downloadTimer);
            }
            document.getElementById("demo").innerHTML = recordingTime;
            recordingTime -= 1;
        }, 1000);
    }


</script>

  
</html>
